---
// server
import Profile from "../../../components/Alias";
import Layout from "../../../layouts/Layout.astro";
import { getGameId } from "../../../lib/params";
import prisma from "../../../lib/prisma";
const gameId = getGameId(Astro);
const { alias } = Astro.params;
let you;

if (alias) {
  try {
    const temp = await prisma.alias.findFirst({
      where: {
        externalId: alias,
      },
      include: {
        teams: true,
      },
    });
    if (temp) {
      you = temp;
      Astro.cookies.set("session-mafia-grande", you.externalId, {
        path: "/",
      });
    }
  } catch {
    console.log("not an alias");
  }
}

export const prerender = false;
---

<Layout>
  <Profile gameId={gameId} alias={you} client:load />
</Layout>
